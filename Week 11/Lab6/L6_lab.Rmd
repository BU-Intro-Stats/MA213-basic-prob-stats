---
title: "MA213 Basic Statistics and Probability - Lab6"
bibliography: references.bib
output:
  pdf_document: default
  html_document:
    code_download: true 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
```

# **Lab 6: Linear Regression**

In this lab session, we will explore practical part of linear regression with a single predictor using R.

#### Learning Objectives

-   **Compute and Interpret Correlation and R²**: Compute and interpret correlation coefficients and R² values, while recognizing that correlation does not imply causation.
-   **Describe and Assess Relationships Between Two Variables**: Describe the association between two numerical variables in a scatter plot in terms of direction, shape (linear or nonlinear), and strength, and assess whether linear regression is an appropriate model.
-   **Fit and Interpret Linear Models Using Least Squares**: Fit the intercept and slope of a linear model to data using the least squares method, interpret the fitted values, and use the model to predict responses to new inputs.
-   **Perform Inference for Regression Coefficients**: Use fit summary and parameter estimates (e.g., $\hat{\beta_1}$ and $\hat{\sigma^2}$ ) to perform hypothesis tests or construct confidence intervals for the slope, and interpret the results.

## Pre-lab activities

-   We are going to work in groups. This time, each group have 2 people. You can discuss the exercise questions and post-lab activities with your members.

```{r}
num_ppl_each_group = 2
student_list <- read.csv("StudentList.csv")
N <- nrow(student_list)

# Sort by last name
student_list <- student_list %>% arrange(Last)
student_list$number <- 1:N

# Shuffle the student numbers randomly
shuffled <- sample(student_list$number)

# Create group
group_ids <- rep(1:ceiling(N / num_ppl_each_group), num_ppl_each_group)[1:N]

# Assign data frame
group_df <- data.frame(number = shuffled, group = group_ids)
grouped_students <- left_join(group_df, student_list, by = "number")

grouped_students <- grouped_students %>% arrange(group)

# Output
grouped_students %>% select(!number)

```

### Lab activities

***Beauty in the class***

Many college courses conclude by giving students the opportunity to evaluate the course and the instructor anonymously. However, the use of these student evaluations as an indicator of course quality and teaching eﬀectiveness is often criticized because these measures may reflect the influence of non-teaching related characteristics, such as the physical appearance of the instructor. Researchers at University of Texas, Austin collected data on teaching evaluation score (higher score means better) and standardized beauty score (a score of 0 means average, negative score means below average, and a positive score means above average) for a sample of 463 professors. (The data was originally considered by @hamermesh2005beauty.)

> Variables in the data frame :
>
> | Name | Details |
> |----|----|
> | minority | is the professor from a non-Caucasian ethnic minority? |
> | age | the professor’s age. |
> | gender | a factor indicating the professor’s gender. |
> | credits | a factor indicating whether the course is a single-credit elective (e.g. scuba diving or ballroom dancing, coded “single”) or an academic course (coded “more”). |
> | beauty | a rating of the professor’s physical attractiveness, as judged by a panel of six students. (The score was averaged across all six panelists, and shifted to have a mean of zero) |
> | eval | the professor’s average teaching evaluation for courses in the sample, on a scale of 1 to 5. |
> | division | whether the course is an upper or lower division course. |
> | native | whether the professor is a native English speaker. |
> | tenure | whether the professor is tenured/tenure-track, or not. |
> | students | the number of students that participated in the evaluation. |
> | allstudents | the number of students enrolled in the course. |
> | prof | a unique numerical identifier for the professor being rated. |

1.  Let's import the data. What are your interests? What could be the response and explanatory variables?

```{r}
library(dplyr)
library(ggplot2)

df <- read.csv("beauty.csv")

glimpse(df)
head(df)



```

Here are some statistics of the `beauty` and `eval`.

|                    | beauty | eval  |
|--------------------|--------|-------|
| Min                | -1.450 | 2.100 |
| Median             | -0.068 | 4.000 |
| Mean               | 0.000  | 3.998 |
| Max                | 1.970  | 5.000 |
| Standard Deviation | 0.788  | 0.554 |

: Descriptive Statistics of beauty and eval

2.  Let's first see how response variable and explanatory variable are related.

We can look at scatter plot to see how `beauty` and `eval` (course ratings) are related.

```{r}

ggplot(data=df, mapping = aes(x=beauty, y=eval)) + geom_point()

#
#
#

```

Let's also check correlation between `beauty` and `eval`.

Correlation $$
R = \frac{1}{n-1} \sum_{i=1}^{n} \frac{x_i - \bar{x}}{s_{x}} \frac{y_i - \bar{y}}{s_{y}}
$$ where $s_x$ is the standard deviation of explanatory variable $x$ and $s_y$ is the standard deviation of response variable.

#### Exercise Q1

let's obtain the correlation between `beauty` and `eval`, $R$, using R.

```{r}
#
#
#
```

Based on the correlation, what does it tell you?

3.  Let's obtain least squares line where the model is $$
    y = \beta_0 + \beta_1 x + \epsilon
    $$ The estimates are $$
    b_1 = \hat{\beta_1} =  (\frac{s_y}{s_x}) R,
    $$

$$
b_0 = \hat{\beta_0} = \bar{y} - b_1 \bar{x}
$$

#### Exercise Q2

Let's obtain the least squares line. Obtain `b0` and `b1`.

```{r}

#
#
#


```

4.  We can check some of the assumptions (conditions) for the least square lines.

#### Exercise Q3

Obtain residuals and show plot of residuals against explanatory variable

```{r}

#
#
#

```

We can check how residuals are distributed.

How do you check if residuals are normally distributed?

#### Exercise Q4

Show histogram plot of residuals

```{r}
#
#
#
```

We can also check QQ plot, quantile-quantile plot. It is a graphical tool to assess if data comes from theoretical distribution (normal distribution in this case). We are expected to see If the points are on the diagonal line.

```{r}

# qqnorm(Resid)
# qqline(Resid) #this will draw 45 degree line for reference purposes.
```

#### Exercise Q5

Let's calculate $R^2$ to describe the strength of a fit

```{r}
#
#
#
```

What does it mean? from $R^2$ value you calculated?

Now, let us walk through the output from `lm()` function in R.

```{r}

#
# model = lm(Y~X)
# summary(model)


```

### Lab activities 2

#### Exercise Q6

Choose one dataset and perform data analysis using simple linear regression. Your group can choose a data from

[Survey of Duke students on GPA, studying, and more](https://www.openintro.org/data/index.php?data=gpa)

[US Crime Rates](https://www.openintro.org/data/index.php?data=us_crime_rates)

[Normal Body Temperature](https://www.openintro.org/data/index.php?data=thermometry)

[State-level data](https://www.openintro.org/data/index.php?data=state_stats)

[SAT and GPA data](https://www.openintro.org/data/index.php?data=satgpa)

[Pierce County House Sales Data for 2020](https://www.openintro.org/data/index.php?data=pierce_county_house_sales)

0.  Import the data

```{r}

#
#
#


```

1.  Check the relationship between response variable and explanatory variable.

```{r}
#
#
#

```

2.  Obtain the least square line and get the residuals.

```{r}
#
#
#

```

3.  Show some plots to check model assumption.

```{r}
#
#
#

```

### Post-lab activities

The Toluca Company manufactures refrigeration equipments as well as many replacement parts. In the past, one of the replacement parts has been produced periodically in lots of varying sizes. When a cost improvement program was undertaken, company officials wished to determine the optimum lot size for producing this part. The production of this part involves setting up the production process (which must be done no matter what is the lot size) and machining and assembly operations. One key input for the model to ascertain the optimum lot size was the relationship between lot size and labour hours required to produce the lot. To determine this relationship, data on lot size and work hours for 25 recent production runs were utilized. The production conditions were stable during the six-month period in which the 25 runs were made and were expected to continue to be the same during the next three years, the planning period for which the cost improvement program was being conducted.

Please name your submission as `lab6.R`

Data here is given in `toluca.csv` .

1.  Calculate the correlation coefficient and save it to object `r2.`

2.  Obtain standard deviations of `X` and `Y`, `sx` and `sy`, respectively.

3.  Obtain the sum of `X` and `Y`, `sumx` and `sumy`, respectively.

4.  Obtain `b0` estimate for $\beta_0$.

5.  Obtain the slope estimate `b1` .

6.  Obtain `R2` .

7.  What is the 5th residual value? Assign it to object `resid5` .
